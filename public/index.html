<!DOCTYPE html>
<html>
<head>
    <title>MailCatcher</title>
    <link href="favicon.ico" rel="icon"/>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" />
    <link rel="stylesheet" href="assets/mailcatcher.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
</head>
<body>
<div id="mc-app" v-cloak>
    <div
        class="mc-app-container"
        :is="currentComponent"
        v-on:logout="logout"
        v-on:login="login"
    ></div>
</div>

<script type="text/x-template" id="mc-login">
    <div>
    <header class="main-header">
        <h1>MailCatcher</h1>
        <nav class="app">
            <form v-on:submit.prevent="loginSubmit">
                <ul>
                    <li class="login"><input v-model="username" placeholder="login"/></li>
                    <li class="password"><input v-model="password" type="password"/></li>
                    <li><button class="button" v-bind:disabled="!dataFilled()" type="submit" value="Login">Login</button></li>
                </ul>
            </form>
        </nav>
    </header>
    </div>
</script>

<script type="text/x-template" id="mc-main">
    <div>
    <header class="main-header">
        <h1>MailCatcher</h1>
        <nav class="app">
            <ul>
                <li class="search" v-if="messages && messages.length">
                    <input type="search" placeholder="Search messages..." incremental="true" v-model="search" />
                </li>
                <li class="username" v-if="showLogoutButton() && userName()">
                    <div>{{ userName() }}</div>
                </li>
                <li class="logout">
                    <button class="button" v-if="showLogoutButton()" v-on:click="$emit('logout')">Logout</button>
                </li>
            </ul>
        </nav>
    </header>

    <div class="sliding-panel">
        <div class="wrapper" v-bind:style="{ height: topBlockHeight + 'px' }">
            <div class="folders">
                <div class="folders-wrapper">
                    <ul>
                        <li v-for="folder in folders" v-bind:key="folder.id" class="noselect"
                            v-bind:class="{ 'selected': isFolderSelected(folder) }">
                            <span class="folder-line" v-on:click="toggleSelectedFolder(folder)">
                                <div class="folder-name-wrapper">
                                    <span class="folder-name" v-bind:title="folder.name">{{ folder.name }}</span>
                                    <span class="folder-qty">[ {{ folder.count }} / {{ folder.new }} new ]</span>
                                </div>
                            </span>
                            <span class="clear-folder" v-on:click="clearMessages(folder)" title="Clear"></span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="emails">
                <div id="messages">
                    <div class="messages-table-container" v-if="messages && messages.length">
                        <div class="messages-header">
                            <div class="messages-cell">From</div>
                            <div class="messages-cell">To</div>
                            <div class="messages-cell">Subject</div>
                            <div class="messages-cell">Received</div>
                        </div>
                        <div class="messages-body">
                            <div class="messages-row" v-for="message in filteredMessagesPaged" v-bind:key="message.id"
                                 v-bind:class="{ 'new': message.new, 'selected': isMessageSelected(message) }"
                                 v-bind:data-message-id="message.id" v-on:click="toggleSelectedMessage(message)"
                            >
                                <div v-if="message.sender" class="messages-cell">{{ message.sender }}</div>
                                <div v-else class="messages-cell no-value">No sender</div>

                                <div v-if="message.recipients && message.recipients.length" class="messages-cell">{{ message.recipients.join(", ") }}</div>
                                <div v-else class="messages-cell no-value">No receipients</div>

                                <div v-if="message.subject" class="messages-cell">{{ message.subject }}</div>
                                <div v-else class="messages-cell no-value">No subject</div>

                                <div class="messages-cell">{{ message.created_at | moment(dateFormat, inputDateFormat) }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="messages-nav" v-if="messages && messages.length">
                        <button class="button" v-bind:disabled="!hasPrevPage" v-on:click.prevent="prevPage">&lt;</button>
                        <button class="button" v-bind:disabled="!hasNextPage" v-on:click.prevent="nextPage">&gt;</button>
                        <span class="has-offset">page: {{ page }} of {{ maxPages }}</span>
                        <span> messages: {{ firstMessageNumber }} to {{ lastMessageNumber }} of {{ filteredMessages.length }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="resizer">
        <div class="ruler"></div>
    </div>

    <div id="message" v-if="selectedMessage" v-bind:class="{ 'expanded': messageExpanded }">
        <div class="message-left">
            <header>
                <ul class="metadata">
                    <li>
                        <div class="metadata-title">Received</div>
                        <div class="metadata-value">{{ selectedMessage.created_at | moment(dateFormat, inputDateFormat) }}</div>
                    </li>
                    <li>
                        <div class="metadata-title">From</div>
                        <div v-if="selectedMessage.sender" class="metadata-value">{{ selectedMessage.sender }}</div>
                        <div v-else class="metadata-value">No sender</div>
                    </li>
                    <li>
                        <div class="metadata-title">To</div>
                        <div v-if="selectedMessage.recipients && selectedMessage.recipients.length" class="metadata-value">
                            {{ (selectedMessage.recipients).join(", ") }}
                        </div>
                        <div v-else class="metadata-value">No receipients</div>
                    </li>
                    <li>
                        <div class="metadata-title">Subject</div>
                        <div v-if="selectedMessage.subject" class="metadata-value">
                            {{ selectedMessage.subject }}
                        </div>
                        <div v-else class="metadata-value no-value">No subject</div>
                    </li>
                    <li v-if="hasAttachments(selectedMessage)">
                        <div class="metadata-title attachments">Attachments</div>
                        <div class="attachments">
                            <ul>
                                <li v-for="attachment in selectedMessage.attachments">
                                    <a v-bind:href="attachmentUrl(selectedMessage, attachment)" target="_blank">{{ attachment.filename }}</a>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </header>
        </div>

        <div class="message-right">
            <nav class="views">
                <ul>
                    <li class="format tab" v-for="presentation in presentations"
                        v-bind:class="{ 'selected': isPresentationSelected(presentation) }">
                        <a href="#" class="button" v-on:click.prevent="selectPresentation(presentation)">{{ presentationDisplayName(presentation) }}</a>
                    </li>
                    <li class="action toggle-height">
                        <a href="#" class="button"
                           v-bind:class="{ 'expanded': messageExpanded }" v-on:click.prevent="toggleMessageExpanded" title="Toggle message"></a>
                    </li>
                    <li class="action download">
                        <a v-bind:href="downloadUrl(selectedMessage)" class="button download" target="_blank" title="Download"></a>
                    </li>
                    <li class="action delete">
                        <a href="#" class="button delete" v-on:click.prevent="deleteMessage(selectedMessage)" title="Delete"></a>
                    </li>
                </ul>
            </nav>
            <iframe class="body" v-if="selectedPresentation" v-bind:src="selectedPresentationUrl()"
                    v-on:load="preparePresentationContent"></iframe>
        </div>
    </div>
    </div>
</script>

<script src="assets/vendor.js"></script>
<script src="assets/mailcatcher.js"></script>
</body>
</html>
